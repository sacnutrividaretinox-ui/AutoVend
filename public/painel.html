<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Painel - AutoVend</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background-color: #f5f7fb;
      }
      .card {
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
      .table th {
        background: #343a40;
        color: white;
        text-align: center;
      }
      .status-ok {
        color: #1f8b24;
        font-weight: 600;
      }
      .status-erro {
        color: #c82333;
        font-weight: 600;
        cursor: pointer;
      }
      .status-erro:hover {
        text-decoration: underline;
      }
      .table td {
        vertical-align: middle;
        text-align: center;
      }
      .summary {
        font-size: 1.2rem;
        font-weight: 500;
      }
      .summary span {
        padding: 5px 10px;
        border-radius: 6px;
      }
      .summary .ok {
        background: #d4edda;
        color: #155724;
      }
      .summary .fail {
        background: #f8d7da;
        color: #721c24;
      }
    </style>
  </head>

  <body class="py-4">
    <div class="container">
      <h2 class="text-center mb-4">üì¶ Produtos Publicados</h2>

      <div class="card p-3 mb-4">
        <div id="resultado" class="summary text-center"></div>
      </div>

      <div class="card p-3">
        <table class="table table-bordered align-middle">
          <thead>
            <tr>
              <th>#</th>
              <th>SKU</th>
              <th>Status</th>
              <th>ID ML</th>
              <th>Link</th>
            </tr>
          </thead>
          <tbody id="tabela-produtos"></tbody>
        </table>

        <div class="text-center mt-3">
          <a href="/" class="btn btn-dark">‚¨Ö Voltar ao in√≠cio</a>
        </div>
      </div>
    </div>

    <script>
      // Fun√ß√£o para buscar resultados do backend
      async function carregarResultados() {
        try {
          const resposta = await fetch("/api/resultados.json");
          const dados = await resposta.json();

          // Exibe contagem de sucesso e falha
          document.getElementById("resultado").innerHTML = `
            ‚úÖ <span class="ok">Sucesso: ${dados.sucesso}</span> &nbsp;
            ‚ùå <span class="fail">Falhas: ${dados.falhas}</span>
          `;

          // Monta a tabela
          const tabela = document.getElementById("tabela-produtos");
          tabela.innerHTML = dados.resultados
            .map(
              (r, i) => `
            <tr>
              <td>${i + 1}</td>
              <td>${r.sku || "-"}</td>
              <td class="${
                r.status.includes("Erro") ? "status-erro" : "status-ok"
              }" title="${
                r.status.includes("Erro")
                  ? r.status.replace("‚ùå", "").trim()
                  : "Publicado com sucesso"
              }">${r.status}</td>
              <td>${r.id_ml || "-"}</td>
              <td>${
                r.link && r.link !== "-"
                  ? `<a href="${r.link}" target="_blank">Abrir an√∫ncio</a>`
                  : "-"
              }</td>
            </tr>`
            )
            .join("");
        } catch (e) {
          document.getElementById("resultado").innerHTML =
            "‚ö†Ô∏è Erro ao carregar resultados.";
        }
      }

      carregarResultados();
    </script>
  </body>
</html>
